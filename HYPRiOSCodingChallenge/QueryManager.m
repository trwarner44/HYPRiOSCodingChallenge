//
//  QueryManager.m
//  HYPRiOSCodingChallenge
//
//  Created by Thomas Warner on 9/15/20.
//  Copyright Â© 2020 Thomas Warner. All rights reserved.
//

#import "QueryManager.h"
#import "School.h"

@implementation QueryManager

NSString *baseUrl = @"https://data.cityofnewyork.us/resource/s3k6-pzi2.json";

+ (void)fetchSchool:(NSString*)dbn completion: (void(^)(School*))callback {
    NSLog(@"fetching school with dbn: %@", dbn);
    NSString *endpoint = [NSString stringWithFormat:@"%@?dbn=%@", baseUrl, dbn];
    
    NSMutableURLRequest *urlRequest = [[NSMutableURLRequest alloc] initWithURL:[NSURL URLWithString:endpoint]];
    [urlRequest setHTTPMethod:@"GET"];
    NSURLSession *session = [NSURLSession sharedSession];
    NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:urlRequest completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;
        if(httpResponse.statusCode == 200) {
            dispatch_async(dispatch_get_main_queue(), ^(void){
                //Run UI Updates
                NSError *parseError = nil;
                NSMutableArray<NSDictionary*> *responseArray = [NSJSONSerialization JSONObjectWithData:data options:0 error:&parseError];
                School *school = [[School alloc] init:responseArray[0]];
                callback(school);
            });
        } else {
            NSLog(@"Error");
        }
    }];
    [dataTask resume];
}

+(NSString*)dbnFor:(NSInteger)rowId {
    NSArray *dbns = @[
        @"02M260",
        @"21K728",
        @"08X282",
        @"17K548",
        @"27Q314",
        @"29Q283",
        @"18K566",
        @"24Q296",
        @"09X505",
        @"27Q475",
        @"02M139",
        @"28Q680",
        @"25Q285",
        @"30Q501",
        @"10X439",
        @"29Q313",
        @"01M450",
        @"02M544",
        @"06M463",
        @"02M449",
        @"25Q252",
        @"14K614",
        @"02M489",
        @"09X227",
        @"10X264",
        @"10X284",
        @"32K549",
        @"02M408",
        @"05M369",
        @"32K552",
        @"10X351",
        @"07X547",
        @"14K561",
        @"23K697",
        @"17K524",
        @"21K468",
        @"08X349",
        @"08X293",
        @"04M409",
        @"07X221",
        @"07X427",
        @"31R047",
        @"02M551",
        @"02M413",
        @"02M459",
        @"32K168",
        @"02M438",
        @"24Q530",
        @"02M422",
        @"17K122",
        @"32K556",
        @"06M462",
        @"18K633",
        @"21K337",
        @"11X455",
        @"02M296",
        @"09X241",
        @"13K419",
        @"15K684",
        @"02M416",
        @"05M148",
        @"03M402",
        @"07X495",
        @"25Q281",
        @"10X433",
        @"17K382",
        @"15K423",
        @"08X312",
        @"02M420",
        @"02M543",
        @"02M439",
        @"28Q505",
        @"27Q351",
        @"02M600",
        @"08X405",
        @"07X548",
        @"02M305",
        @"02M303",
        @"11X299",
        @"12X248",
        @"28Q687",
        @"13K439",
        @"29Q272",
        @"06M346",
        @"03M859",
        @"17K590",
        @"28Q325",
        @"10X243",
        @"18K589",
        @"18K563",
        @"18K569",
        @"16K393",
        @"12X682",
        @"07X551",
        @"17K533",
        @"10X438",
        @"17K546",
        @"30Q445",
        @"09X412",
        @"26Q315",
        @"24Q264",
        @"06M467",
        @"17K745",
        @"28Q440",
        @"02M412",
        @"25Q670",
        @"02M399",
        @"19K507",
        @"01M448",
        @"31R600",
        @"27Q480",
        @"02M294",
        @"20K485",
        @"27Q262",
        @"14K558",
        @"28Q896",
        @"17K408",
        @"08X305",
        @"10X368",
        @"12X479",
        @"11X545",
        @"24Q455",
        @"09X517",
        @"27Q324",
        @"08X561",
        @"07X670",
        @"02M288",
        @"29Q492",
        @"15K463",
        @"08X452",
        @"20K490",
        @"25Q525",
        @"17K600",
        @"02M520",
        @"22K630",
        @"02M414",
        @"21K620",
        @"07X600",
        @"21K540",
        @"01M292",
        @"11X253",
        @"10X237",
        @"10X342",
        @"11X509",
        @"09X263",
        @"21K344",
        @"18K567",
        @"02M437",
        @"02M300",
        @"02M374",
        @"02M282",
        @"10X445",
        @"31R605",
        @"25Q460",
        @"25Q425",
        @"13K670",
        @"01M696",
        @"11X288",
        @"31R080",
        @"16K688",
        @"11X542",
        @"18K637",
        @"10X437",
        @"24Q485",
        @"03M415",
        @"07X473",
        @"17K528",
        @"27Q650",
        @"02M418",
        @"27Q308",
        @"30Q450",
        @"11X275",
        @"11X270",
        @"17K537",
        @"14K071",
        @"14K632",
        @"10X565",
        @"30Q286",
        @"31R455",
        @"19K659",
        @"03M494",
        @"07X223",
        @"06M211",
        @"02M655",
        @"10X374",
        @"30Q575",
        @"02M425",
        @"09X260",
        @"10X213",
        @"19K764",
        @"26Q435",
        @"02M419",
        @"15K519",
        @"21K348",
        @"15K462",
        @"02M534",
        @"12X271",
        @"27Q260",
        @"03M307",
        @"13K483",
        @"12X321",
        @"14K586",
        @"05M304",
        @"27Q400",
        @"02M376",
        @"12X267",
        @"13K595",
        @"05M499",
        @"18K642",
        @"22K405",
        @"17K531",
        @"21K525",
        @"09X250",
        @"02M500",
        @"11X544",
        @"08X432",
        @"24Q299",
        @"19K502",
        @"13K499",
        @"02M135",
        @"03M541",
        @"01M509",
        @"02M542",
        @"08X348",
        @"07X334",
        @"28Q350",
        @"08X559",
        @"04M495",
        @"14K478",
        @"02M545",
        @"12X550",
        @"11X418",
        @"08X519",
        @"28Q310",
        @"31R450",
        @"02M400",
        @"23K644",
        @"13K350",
        @"29Q265",
        @"24Q585",
        @"27Q334",
        @"05M362",
        @"11X290",
        @"08X332",
        @"19K583",
        @"25Q241",
        @"12X478",
        @"32K403",
        @"09X350",
        @"12X511",
        @"19K504",
        @"16K455",
        @"14K685",
        @"21K559",
        @"26Q430",
        @"09X403",
        @"14K610",
        @"13K527",
        @"21K690",
        @"16K765",
        @"02M605",
        @"02M308",
        @"14K488",
        @"09X324",
        @"22K555",
        @"12X251",
        @"10X442",
        @"26Q495",
        @"02M630",
        @"02M393",
        @"10X546",
        @"02M615",
        @"32K545",
        @"19K683",
        @"09X365",
        @"07X259",
        @"10X440",
        @"10X434",
        @"10X268",
        @"06M293",
        @"22K535",
        @"17K547",
        @"02M531",
        @"02M519",
        @"14K474",
        @"09X568",
        @"01M539",
        @"02M432",
        @"15K497",
        @"28Q328",
        @"30Q555",
        @"30Q301",
        @"24Q600",
        @"08X376",
        @"09X231",
        @"09X404",
        @"19K660",
        @"15K667",
        @"17K489",
        @"03M485",
        @"10X225",
        @"07X500",
        @"24Q610",
        @"22K425",
        @"19K404",
        @"16K594",
        @"09X329",
        @"12X692",
        @"04M435",
        @"12X684",
        @"20K609",
        @"14K449",
        @"13K605",
        @"09X564",
        @"08X558",
        @"24Q550",
        @"15K448",
        @"09X543",
        @"29Q498",
        @"03M492",
        @"28Q167",
        @"09X297",
        @"23K514",
        @"11X249",
        @"15K592",
        @"11X514",
        @"11X508",
        @"22K611",
        @"09X413",
        @"12X242",
        @"13K430",
        @"09X276",
        @"06M348",
        @"10X477",
        @"13K674",
        @"03M860",
        @"30Q502",
        @"09X327",
        @"02M280",
        @"10X549",
        @"06M540",
        @"02M407",
        @"05M692",
        @"15K656",
        @"17K751",
        @"10X524",
        @"04M680",
        @"29Q326",
        @"32K554",
        @"12X521",
        @"18K629",
        @"02M580",
        @"02M475",
        @"04M610",
        @"02M392",
        @"02M411",
        @"23K647",
        @"02M529",
        @"03M299",
        @"30Q580",
        @"13K265",
        @"28Q686",
        @"31R064",
        @"19K422",
        @"18K576",
        @"10X696",
        @"19K618",
        @"05M670",
        @"28Q284",
        @"10X141",
        @"19K615",
        @"19K510",
        @"03M479",
        @"02M047",
        @"09X525",
        @"24Q520",
        @"20K445",
        @"27Q323",
        @"02M316",
        @"29Q259",
        @"11X513",
        @"24Q267",
        @"26Q415",
        @"15K429",
        @"21K572",
        @"31R460",
        @"31R445",
        @"28Q690",
        @"24Q236",
        @"04M555",
        @"02M427",
        @"31R440",
        @"11X265",
        @"19K639",
        @"18K617",
        @"02M546",
        @"24Q560",
        @"06M552",
        @"25Q240",
        @"17K543",
        @"09X252",
        @"06M468",
        @"13K412",
        @"27Q309",
        @"07X527",
        @"27Q302",
        @"25Q263",
        @"28Q620",
        @"08X530",
        @"14K454",
        @"07X522",
        @"02M298",
        @"16K498",
        @"21K410",
        @"06M423",
        @"03M403",
        @"29Q248",
        @"12X372",
        @"08X320",
        @"26Q566",
        @"30Q258",
        @"02M507",
        @"02M533",
        @"05M367",
        @"04M372",
        @"08X269",
        @"05M157",
        @"23K493",
        @"20K505",
        @"17K539",
        @"29Q327",
        @"19K409",
        @"10X353",
        @"29Q243",
        @"03M417",
        @"15K464",
        @"24Q293",
        @"12X388",
        @"08X367",
        @"14K477",
    ];
        
    NSString *dbn = dbns[rowId];
    
    return dbn;
}



@end
